<!DOCTYPE html>
<!-- saved from url=(0114)https://www.ons.gov.uk/visualisations/dvc402/chart3/index.html?initialWidth=700&childId=799-4cf4-8b5f-75af3fac33e8 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="./css(1)" rel="stylesheet" type="text/css">
<title>Destination of EU goods exports</title>
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="./globalStyle.css">
<style type="text/css">body{max-width:700px;}.bar_pos{fill:#CCC;}.bar_neg{fill:#003399;}.background0{background:#CCC;}.background1{background:#003399;}</style>
</head>
<body marginheight="0">
<div id="graphic"><svg width="700" height="516"><g transform="translate(107,5)"><rect class="svgRect" width="583" height="476"></rect><g class="x axis" transform="translate(0, 476)"><g class="tick major" transform="translate(0,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text y="9" x="0" dy=".71em" style="text-anchor: middle;">0.0</text></g><g class="tick major" transform="translate(121.46870878554209,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text y="9" x="0" dy=".71em" style="text-anchor: middle;">1.0</text></g><g class="tick major" transform="translate(242.93741757108418,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text y="9" x="0" dy=".71em" style="text-anchor: middle;">2.0</text></g><g class="tick major" transform="translate(364.40612635662626,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text y="9" x="0" dy=".71em" style="text-anchor: middle;">3.0</text></g><g class="tick major" transform="translate(485.87483514216837,0)" style="opacity: 1;"><line y2="6" x2="0"></line><text y="9" x="0" dy=".71em" style="text-anchor: middle;">4.0</text></g><path class="domain" d="M0,6V0H583V6"></path><text y="25" x="583" dy=".71em" style="text-anchor: end;">$ USD trillions</text></g><g class="x grid"><g class="tick major" transform="translate(0,0)" style="opacity: 1;"><line y2="476" x2="0"></line><text y="479" x="0" dy=".71em" style="text-anchor: middle;"></text></g><g class="tick major" transform="translate(121.46870878554209,0)" style="opacity: 1;"><line y2="476" x2="0"></line><text y="479" x="0" dy=".71em" style="text-anchor: middle;"></text></g><g class="tick major" transform="translate(242.93741757108418,0)" style="opacity: 1;"><line y2="476" x2="0"></line><text y="479" x="0" dy=".71em" style="text-anchor: middle;"></text></g><g class="tick major" transform="translate(364.40612635662626,0)" style="opacity: 1;"><line y2="476" x2="0"></line><text y="479" x="0" dy=".71em" style="text-anchor: middle;"></text></g><g class="tick major" transform="translate(485.87483514216837,0)" style="opacity: 1;"><line y2="476" x2="0"></line><text y="479" x="0" dy=".71em" style="text-anchor: middle;"></text></g><path class="domain" d="M0,0V0H583V0"></path></g><g class="y axis" transform="translate(0, 0)"><g class="tick major" transform="translate(0,28)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>EU excluding UK</tspan></text></g><g class="tick major" transform="translate(0,70)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>China</tspan></text></g><g class="tick major" transform="translate(0,112)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>USA</tspan></text></g><g class="tick major" transform="translate(0,154)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Germany</tspan></text></g><g class="tick major" transform="translate(0,196)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Japan</tspan></text></g><g class="tick major" transform="translate(0,238)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Rep. of Korea</tspan></text></g><g class="tick major" transform="translate(0,280)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>France</tspan></text></g><g class="tick major" transform="translate(0,322)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Netherlands</tspan></text></g><g class="tick major" transform="translate(0,364)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Hong Kong</tspan></text></g><g class="tick major" transform="translate(0,406)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>Italy</tspan></text></g><g class="tick major" transform="translate(0,448)" style="opacity: 1;"><line x2="-6" y2="0"></line><text x="-9" y="0" dy=".32em" style="text-anchor: end;"><tspan>United Kingdom</tspan></text></g><path class="domain" d="M-6,0H0V476H-6"></path></g><g class="bars"><rect fill="#ccc" width="583" x="0" y="9" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="277.4928358463952" x="0" y="51" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="182.75938986455094" x="0" y="93" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="160.78691513233423" x="0" y="135" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="75.8920701559925" x="0" y="177" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="63.98437116503701" x="0" y="219" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="60.013802012255205" x="0" y="261" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="57.22281549048981" x="0" y="303" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="56.49230267585356" x="0" y="345" height="38" style="opacity: 0.8;"></rect><rect fill="#ccc" width="55.69060919786898" x="0" y="387" height="38" style="opacity: 0.8;"></rect><rect fill="#003399" width="52.89282042841159" x="0" y="429" height="38" style="opacity: 0.8;"></rect></g></g></svg></div>
<div id="keypoints"></div>
<div class="footer"><p id="source">Source: <a href="https://comtrade.un.org/data/" target="_blank">UN Comtrade</a></p>
</div>
<script src="./jquery.js" type="text/javascript"></script>
<script src="./d3.v3.min.js" type="text/javascript"></script>
<script src="./modernizr.svg.min.js" type="text/javascript"></script>
<script src="./pym.js" type="text/javascript"></script>
<script>

		var graphic = $('#graphic');
		var keypoints = $('#keypoints');
		var footer = $(".footer");
		var pymChild = null;

		function drawGraphic(width) {
		   var threshold_md = 788;
		   var threshold_sm = dvc.optional.mobileBreakpoint; 
		  
		  	//set variables for chart dimensions dependent on width of #graphic
		    if (graphic.width() < threshold_sm) {        	
		            var margin = {top: dvc.optional.margin_sm[0], right: dvc.optional.margin_sm[1], bottom: dvc.optional.margin_sm[2], left: dvc.optional.margin_sm[3]}; 
					var chart_width = graphic.width() - margin.left - margin.right;
		            var height = Math.ceil((chart_width * dvc.optional.aspectRatio_sm[1]) / dvc.optional.aspectRatio_sm[0]) - margin.top - margin.bottom;
		    } else if (graphic.width() < threshold_md){
		        	var margin = {top: dvc.optional.margin_md[0], right: dvc.optional.margin_md[1], bottom: dvc.optional.margin_md[2], left: dvc.optional.margin_md[3]}; 
					var chart_width = graphic.width() - margin.left - margin.right;
		            var height = Math.ceil((chart_width * dvc.optional.aspectRatio_md[1]) / dvc.optional.aspectRatio_md[0]) - margin.top - margin.bottom;
		  	} else {
		        	var margin = {top: dvc.optional.margin_lg[0], right: dvc.optional.margin_lg[1], bottom: dvc.optional.margin_lg[2], left: dvc.optional.margin_lg[3]}
					var chart_width = graphic.width() - margin.left - margin.right;
		            var height = Math.ceil((chart_width * dvc.optional.aspectRatio_lg[1]) / dvc.optional.aspectRatio_lg[0]) - margin.top - margin.bottom;
			}

		    // clear out existing graphics
		    graphic.empty();
			keypoints.empty();
			//footer.empty();
			
			
			// parse data into columns
		    var bars=[];
		    for (var column in graphic_data[0]) {
		        if (column == 'name') continue;
				//console.log(column);
		        bars[column] = graphic_data.map(function(d) {
		            return {
					//	bars.x	: csv.column_headings	
		                'region': d.name,
		                'val': +d.value  //[column] 
		            };
		        });
		    }
				
			var x = d3.scale.linear()
		        .range([ 0, chart_width]);

			var y = d3.scale.ordinal()
				.rangeRoundBands([0, height], .1)
			
		    y.domain(graphic_data.map(function(d) { return d.name; }));
			/*y.domain(bars.forEach(function(d){	console.log("Dom "+d.region);
														return d.region;
														})   );*/

		    var yAxis = d3.svg.axis()
		        .scale(y)
		        .orient("left")
		    
		    var xAxis = d3.svg.axis()
		        .scale(x)
		        .orient('bottom');
				
		    			    
			//specify number or ticks on x axis
			var formatPercent = d3.format(",f");
			var formatPercentdp = d3.format(",.1f");
			
			if (graphic.width() <= threshold_sm) {
				xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[0]).tickFormat( function(d){ return formatPercentdp(d/1000000000000); });
			 } else if (graphic.width() <= threshold_md){
				xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[1]).tickFormat( function(d){ return formatPercentdp(d/1000000000000); });
			 } else {
				xAxis.ticks(dvc.optional.x_num_ticks_sm_md_lg[2]).tickFormat( function(d){ return formatPercentdp(d/1000000000000); });
			 }
				
		    //gridlines
		    var x_axis_grid = function() { return xAxis; }		    
			
		  	//y domain calculations	: zero to intelligent max choice, or intelligent min and max choice,  or interval chosen manually
	   		if (dvc.essential.xAxisScale == "auto_zero_max"){
			   var xDomain = [
								0, d3.max(d3.entries(bars), function(c) {
									return d3.max(c.value, function(v) {
										var n = v.val;
										return Math.ceil(n);
									});
								})  ];
								
			} else if (dvc.essential.xAxisScale == "auto_min_max"){ 
				var xDomain = [
								d3.min(d3.entries(bars), function(c) { // d3.entries() returns an array where each element has a key and a value member. 
									return d3.min(c.value, function(v) {
										var n = v.val;  //console.log(v.val);
										return Math.floor(n);
									});
								}),
							
								d3.max(d3.entries(bars), function(c) {
									return d3.max(c.value, function(v) {
										var n = v.val;  //console.log(v.val);
										return Math.ceil(n);
									});
								})
					 		];
			} else {
			   var xDomain = dvc.essential.xAxisScale;
		    }
				 
		    x.domain(xDomain);
		   // console.log(xDomain);
			 
			//create legend
			if(dvc.essential.legendLabels.length > 1){
			var legend = d3.select('#graphic').append('ul')
			                .attr('class', 'key')
			            .selectAll('g')
			                .data(dvc.essential.legendLabels)
			            .enter().append('li')

				    legend.append('b')
						 .attr("class",function(d,i){return "background" + i})
				    
					legend.append('label')
				         .html(function(d,i) { return dvc.essential.legendLabels[i]; });						
			}

			
		    //create svg for chart
		    var svg = d3.select('#graphic').append('svg')
				        .attr("width", chart_width + margin.left + margin.right)
				        .attr("height", height + margin.top + margin.bottom +30)
				        .append("g")
				        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				
					svg.append("rect")
						.attr("class","svgRect")
						.attr("width", chart_width)
						.attr("height", height)
			    
				    svg.append('g')
				        .attr('class', 'x axis')
				        .attr("transform", "translate(0, "+height+")")
				        .call(xAxis)
						.append("text")
						 .attr("y", 25)
						 .attr("x",chart_width)
						 .attr("dy", ".71em")
						 .style("text-anchor", "end")
						 .text(function(d,i){// if (graphic.width() < threshold_sm)
						 					//{ 
											return dvc.essential.xAxisLabel[0];// }
											//else {
							 				//		return dvc.essential.xAxisLabel[1]; }
						 					});
						 
				    svg.append('g')
				        .attr('class', 'x grid')
				        .call(x_axis_grid()
				            .tickSize(height, 0, 0)
				            .tickFormat('')
				        );
					
					//create y axis, if x axis doesn't start at 0 drop x axis accordingly	
					svg.append('g')
				        .attr('class', 'y axis')
				        .attr('transform', function(d){ 
				        			if(xDomain[0] != 0){
										return 'translate(' + ( - 30) + ',0)'
									} else {
										return 'translate(' + 0  + ', 0)'
									}
							})
				        .call(yAxis);

			svg.append('g').attr("class","bars").selectAll('rect')
					.data(bars["value"])  //["value"]
					.enter()
					.append('rect')
					.attr('fill', function(d, i) {
			                if (i == 10) { //console.log("neg "+d.val);
								return '#003399'; 
							} else { 
								return '#ccc'; 
							}
			            })
					.style('opacity', 0.8)
					.attr("width", function(d) { return 0 + Math.abs(x(d.val) - x(0)); })
					.attr("x", function(d) { return x(Math.min(0, d.val)); })
					.attr("y", function(d) { return y(d.region); })
					.attr("height", y.rangeBand())
					
					//create centre line if required
					if (dvc.optional.centre_line == true){
						svg.append("line")
							.attr("id","centreline")
							.attr('y1',0)
							.attr('y2',height)
							.attr('x1',x(dvc.optional.centre_line_value))
							.attr('x2',x(dvc.optional.centre_line_value))
					
					} else if(xDomain[0] <0){
						svg.append("line")
						svg.append("line")
							.attr("id","centreline")
							.attr('y1',0)
							.attr('y2',height)
							.attr('x1',x(0))
							.attr('x2',x(0))
					}  	
					
			writeAnnotation();
							
			function writeAnnotation(){
			
				if (graphic.width() < threshold_sm) {
					
						dvc.essential.annotationBullet.forEach(function(d,i) {
						
							d3.select("#keypoints").append("svg")
								.attr("width","20px")
								.attr("height","20px")
								.attr("class","circles")
								.append("circle")
								.attr("class", "annocirc" + (i))
								.attr("r", "2")
								.attr('cy',"12px")
								.attr("cx", "10px");
							
							d3.select("#keypoints").append("p").text(dvc.essential.annotationBullet[i]);
						
						})// end foreach
				}		
				else {
					
						dvc.essential.annotationChart.forEach(function(d,i) {	
						
							// draw annotation text based on content of var annotationArray ...
							svg.append("text")
								.text(dvc.essential.annotationChart[i])
								.attr("class","annotext" + i)
								.attr("text-anchor", dvc.essential.annotationAlign[i])
								.attr('y',y(dvc.essential.annotationXY[i][1]))
								.attr('x',x(dvc.essential.annotationXY[i][0]));
										
							d3.selectAll(".annotext" + (i))
								.each(insertLinebreaks)
								.each(createBackRect);	
								
								
							function insertLinebreaks() {
								
								var str = this;
			
								var el1 = dvc.essential.annotationChart[i];
								var el = el1.data;
						
								var words = el1.split('  ');
								
								d3.select(this/*str*/).text('');
							
								for (var j = 0; j < words.length; j++) {
									var tspan = d3.select(this).append('tspan').text(words[j]);
									if (j > 0)
										tspan.attr('x', x(dvc.essential.annotationXY[i][0])).attr('dy', '22');													
								}
							};					
													
							function createBackRect() {
								
							var BBox = this.getBBox()
											
									svg.insert("rect", ".annotext" + (i))
										.attr("width", BBox.width)
										.attr("height", BBox.height)
										.attr("x", BBox.x)
										.attr("y", BBox.y)
										.attr("fill", "white")
										.attr("opacity", 0.4);
										
							}; // end function createBackRect()

						});	// end foreach 		
					
				} // end else ... 
				
				// If you have labels rather than years then you can split the lines using a double space (in the CSV file).
			
			
				function insertLinebreaksLabels() {
								var str = this.textContent;
			
								var words = str.split('  ');
								
								d3.select(this/*str*/).text('');
							
								for (var j = 0; j < words.length; j++) {
									var tspan = d3.select(this).append('tspan').text(words[j]);
									if (j > 0)
										tspan
										.attr('x', -10)			
										.attr('dy', '1em');													
										}
				};	
				
				d3.selectAll(".y text").each(insertLinebreaksLabels)
				
				
			}// end function writeAnnotation()
							
			//create link to source				
//			d3.select(".footer").append("p")
//				.text("Source: ")
//				.append("a")
//				.attr("href", dvc.essential.sourceURL)
//				.attr("target", "_blank")
//				.html(dvc.essential.sourceText);
						
			//use pym to calculate chart dimensions	
		    if (pymChild) {
		        pymChild.sendHeight();
		    }
		}

		//check whether browser can cope with svg	
		if (Modernizr.svg) {
		   //load config 
			d3.json("config.json", function(error, config) {
			dvc=config

				//load chart data
				d3.csv(dvc.essential.graphic_data_url, function(error, data)
				{
					graphic_data = data;
					// get my keys if you so wish
					//names = d3.keys(/*data*/graphic_data[0]).filter(function(key) { return key; });
			  		//console.log(names[0]);
					
					
						
						//use pym to create iframed chart dependent on specified variables
						pymChild = new pym.Child({ renderCallback: drawGraphic});
					});
			})

		} else {
			 //use pym to create iframe containing fallback image (which is set as default)
			 pymChild = new pym.Child();
			if (pymChild) {
		        pymChild.sendHeight();
		    }
		}
    </script>


</body></html>